<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Generador Etiquetas 8x5 | MarckBusiness</title>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:#0b1220;
  color:#eaf1ff;
}
.wrap{max-width:1200px;margin:auto;padding:20px}
h1{margin:0;font-size:18px}
.card{
  background:#0f1b2f;
  border-radius:16px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 14px 40px rgba(0,0,0,.45)
}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

input,select,button{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:#0b1628;
  color:#fff;
  font-weight:700
}
button{
  cursor:pointer;
  background:linear-gradient(90deg,#2b7cff,#1dd3b0);
  border:none
}
button.secondary{background:#0b1628}
button.danger{background:#b91c1c}
.row{display:flex;gap:10px}
.row>*{flex:1}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.1);font-size:13px}
th{color:#cfe4ff}

.preview{
  background:#fff;
  color:#111;
  padding:10px;
  border-radius:12px;
  width:320px
}
.preview .top{display:flex;justify-content:space-between;font-weight:900}
.preview .name{font-size:15px;max-width:65%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
.preview .price{font-size:16px}
.preview svg{width:100%;height:45px}
.footer{text-align:center;font-size:11px;color:#aaa;margin-top:10px}
</style>
</head>

<body>
<div class="wrap">

<h1>GENERADOR ETIQUETAS 8×5 CM</h1>

<div class="grid">

<div class="card">
<div class="row">
<input id="pCode" placeholder="SKU 5 dígitos">
<button id="btnNext" class="secondary">Auto</button>
</div>
<input id="pName" placeholder="Nombre del producto">
<input id="pPrice" placeholder="Precio">
<div class="row">
<button id="btnSave">Guardar</button>
<button id="btnClear" class="secondary">Limpiar</button>
</div>

<div class="preview">
<div class="top">
<div class="name" id="pvName">—</div>
<div class="price" id="pvPrice">Q0.00</div>
</div>
<div>SKU: <span id="pvCode">00000</span></div>
<svg id="pvBarcode"></svg>
<div style="font-size:9px;text-align:center">MarckBusiness © 2025</div>
</div>
</div>

<div class="card">
<input id="qSearch" placeholder="Buscar">
<select id="pick"></select>
<input id="qty" type="number" value="1">
<div class="row">
<button id="btnAdd">Agregar</button>
<button id="btnPDF">PDF</button>
</div>

<table>
<thead><tr><th>SKU</th><th>Nombre</th><th>Precio</th><th>Cant</th></tr></thead>
<tbody id="queueBody"></tbody>
</table>
</div>

</div>

<div class="card">
<button id="btnExcel" class="secondary">Importar Excel</button>
<input type="file" id="excelFile" accept=".xlsx,.xls,.csv" hidden>
</div>

<div class="footer">MarckBusiness © 2025 • Todos los derechos reservados</div>

</div>

<script>
const $=id=>document.getElementById(id);
const state={queue:[]};

function money(n){return "Q"+(+n||0).toFixed(2)}
function fit(doc,text,max,start=15,min=9){
  let s=start;doc.setFontSize(s);
  while(s>min && doc.getTextWidth(text)>max){s-=.5;doc.setFontSize(s)}
  if(doc.getTextWidth(text)<=max)return{text,size:s};
  doc.setFontSize(min);
  let t=text;
  while(t.length && doc.getTextWidth(t+"…")>max)t=t.slice(0,-1);
  return{text:t+"…",size:min};
}

function preview(){
  const c=$("pCode").value||"00000";
  const n=$("pName").value||"—";
  const p=$("pPrice").value||0;
  $("pvCode").textContent=c;
  $("pvName").textContent=n;
  $("pvPrice").textContent=money(p);
  JsBarcode($("pvBarcode"),c,{displayValue:false,height:40,width:2,margin:0});
}

["pCode","pName","pPrice"].forEach(i=>$(i).oninput=preview);

$("btnNext").onclick=()=>{$("pCode").value=Math.floor(Math.random()*90000+10000);preview()}
$("btnClear").onclick=()=>{$("pCode").value="";$("pName").value="";$("pPrice").value="";preview()}

$("btnSave").onclick=()=>{
  state.queue.push({code:$("pCode").value,name:$("pName").value,price:$("pPrice").value,qty:1});
  renderQueue();
}

function renderQueue(){
  $("queueBody").innerHTML="";
  state.queue.forEach(i=>{
    $("queueBody").innerHTML+=`<tr><td>${i.code}</td><td>${i.name}</td><td>${money(i.price)}</td><td>${i.qty}</td></tr>`;
  });
}

$("btnPDF").onclick=()=>{
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF({orientation:"landscape",unit:"mm",format:[80,50]});
  state.queue.forEach((i,x)=>{
    if(x)doc.addPage();
    doc.setFont("helvetica","bold");
    const price=money(i.price);
    const f=fit(doc,i.name,55);
    doc.setFontSize(f.size);
    doc.text(f.text,3,9);
    doc.setFontSize(16);
    doc.text(price,78,9,{align:"right"});
    doc.setFontSize(9);
    doc.text("SKU: "+i.code,3,14);
    const c=document.createElement("canvas");
    JsBarcode(c,i.code,{displayValue:false,height:80,width:2});
    doc.addImage(c.toDataURL(),"PNG",3,16,74,22);
    doc.setFontSize(7);
    doc.text("MarckBusiness © 2025",40,49,{align:"center"});
  });
  window.open(doc.output("bloburl"));
}

$("btnExcel").onclick=()=>$("excelFile").click();
$("excelFile").onchange=async e=>{
  const d=new Uint8Array(await e.target.files[0].arrayBuffer());
  const wb=XLSX.read(d,{type:"array"});
  const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
  rows.forEach(r=>{
    if(r.SKU && r.NOMBRE && r.PRECIO)
      state.queue.push({code:r.SKU,name:r.NOMBRE,price:r.PRECIO,qty:1});
  });
  renderQueue();
};
</script>
</body>
</html>

